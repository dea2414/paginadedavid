<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Precipitation Forecast</title>
  <!-- leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet/dist/leaflet.css"
  />
  <style>
    /* full-screen map container */
    html, body { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100%; font:16px sans-serif; text-align:center; }
  </style>
</head>
<body>
  <div id="map">loadingâ€¦</div>

  <!-- leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
  (async function() {
    const key = 'fcf78e5c32b166d2e4507c5f95e2fca7';  // your OpenWeather API key
    const mapEl = document.getElementById('map');

    try {
      // 1) lookup via ipapi.co (HTTPS)
      const resp = await fetch('https://ipapi.co/json/');
      if (!resp.ok) throw new Error('geolookup status ' + resp.status);
      const data = await resp.json();
      console.log('geo:', data);

      const lat = data.latitude  || 39.8283;  // fallback if missing
      const lon = data.longitude || -98.5795;

      // 2) init Leaflet
      const map = L.map('map').setView([lat, lon], 6);

      // 3) OSM base layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap'
      }).addTo(map);

      // 4) OpenWeather precipitation overlay
      const layer = L.tileLayer(
        `https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${key}`,
        { maxZoom: 19, opacity:0.5, attribution:'&copy; OpenWeatherMap' }
      );
      layer.on('tileerror', e => console.error('tileerror', e));
      layer.addTo(map);

    } catch (err) {
      console.error('map failed:', err);
      mapEl.textContent = 'map failed to load: ' + err.message;
    }
  })();
  </script>
</body>
</html>
